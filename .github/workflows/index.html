<!DOCTYPE html>
<html>
<head>
 <base target="_top">
 <title>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏£‡πå‡∏°</title>


 <!-- Google Font: Kanit -->
 <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
 <!-- Tailwind CSS CDN -->
 <script src="https://cdn.tailwindcss.com"></script>
 <style>
   body {
     font-family: 'Kanit', sans-serif;
     background-color: #e6e0ff; /* Light lavender/purple pastel */
     display: flex;
     justify-content: center;
     align-items: center;
     min-height: 100vh;
     margin: 0;
     padding: 20px;
     box-sizing: border-box;
     text-align: center;
     overflow: hidden; /* Prevent scroll for floating elements */
   }
   .container {
     background-color: #ffffff;
     padding: 3rem 2rem;
     border-radius: 2rem; /* More rounded corners */
     box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
     max-width: 600px;
     width: 100%;
     box-sizing: border-box;
     position: relative;
     z-index: 10; /* Ensure content is above floating elements */
   }
   h1 {
     color: #e91e63; /* Deep pink for emphasis */
     margin-bottom: 1.5rem;
     font-weight: 700;
     font-size: 3.5rem; /* Larger font size for heading */
     line-height: 1.2;
   }
   p {
     color: #6a0572; /* Dark purple */
     font-size: 1.5rem;
     line-height: 1.6;
     margin-bottom: 2rem;
   }
   .emoji {
     font-size: 4rem;
     margin: 0 10px;
     display: inline-block;
     animation: bounce 2s infinite ease-in-out;
   }
   .emoji:nth-child(even) {
     animation-delay: 0.2s;
   }


   /* Floating balloons */
   .balloon {
     position: absolute;
     width: 60px;
     height: 80px;
     background-color: #ffc0cb; /* Light pink */
     border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
     opacity: 0.8;
     animation: float 10s infinite ease-in-out;
     z-index: 1;
   }
   .balloon::before {
     content: '';
     position: absolute;
     bottom: -10px;
     left: 50%;
     transform: translateX(-50%);
     width: 0;
     height: 0;
     border-left: 5px solid transparent;
     border-right: 5px solid transparent;
     border-top: 15px solid #ffc0cb;
     border-radius: 50%;
   }
   .balloon:nth-child(1) { top: 10%; left: 5%; background-color: #a7d9f7; animation-delay: 0s; } /* Light blue */
   .balloon:nth-child(2) { top: 20%; right: 10%; background-color: #b2f7a7; animation-delay: 2s; } /* Light green */
   .balloon:nth-child(3) { bottom: 15%; left: 15%; background-color: #f7a7d9; animation-delay: 4s; } /* Light purple */
   .balloon:nth-child(4) { top: 5%; right: 25%; background-color: #f7d9a7; animation-delay: 6s; } /* Light orange */
   .balloon:nth-child(5) { bottom: 5%; left: 30%; background-color: #a7f7d9; animation-delay: 8s; } /* Light teal */


   @keyframes bounce {
     0%, 100% { transform: translateY(0); }
     50% { transform: translateY(-10px); }
   }


   @keyframes float {
     0%, 100% { transform: translateY(0) rotate(0deg); }
     25% { transform: translateY(-20px) rotate(5deg); }
     50% { transform: translateY(0) rotate(-5deg); }
     75% { transform: translateY(-10px) rotate(2deg); }
   }


   /* Responsive adjustments */
   @media (max-width: 640px) {
     h1 {
       font-size: 2.5rem;
     }
     p {
       font-size: 1.2rem;
     }
     .emoji {
       font-size: 3rem;
     }
     .container {
       padding: 2rem 1rem;
     }
     .balloon {
       width: 40px;
       height: 60px;
     }
     .balloon::before {
       border-top: 10px solid;
     }
   }
   /* Loading spinner for LLM feature */
   .loading-spinner {
     border: 4px solid rgba(255, 255, 255, 0.3);
     border-top: 4px solid #fff;
     border-radius: 50%;
     width: 24px;
     height: 24px;
     animation: spin 1s linear infinite;
     display: inline-block;
     vertical-align: middle;
   }
   @keyframes spin {
     0% { transform: rotate(0deg); }
     100% { transform: rotate(360deg); }
   }
 </style>
</head>
<body>
 <!-- Floating balloons for a festive touch -->
 <div class="balloon"></div>
 <div class="balloon"></div>
 <div class="balloon"></div>
 <div class="balloon"></div>
 <div class="balloon"></div>


 <div class="container">
   <!-- Pat's image and birthday cake with age -->
   <div class="flex flex-col sm:flex-row items-center justify-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4">
     <img
       src="11.jpg"
       alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏û‡∏ó"
       class="w-32 h-32 rounded-full object-cover border-4 border-pink-300 shadow-md"
     />
     <div class="flex items-center text-5xl font-bold text-gray-800">
       <span class="mr-2">üéÇ </span>
       <span>19 year </span>
     </div>
   </div>


  
   <p>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏¥‡πà‡∏á‡∏î‡∏µ‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ô‡∏∞</p>
   <p>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏Ñ‡∏¥‡∏î‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏î‡∏Å‡πá‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏´‡∏ß‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£</p>
   <p>‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏µ‡πâ‡∏ô‡∏∞!</p>
   <div class="flex justify-center items-center mt-6">
     <span class="emoji">üíñ</span>
     <span class="emoji">‚ú®</span>
     <span class="emoji">ü•≥</span>
   </div>


   <hr class="my-8 border-t-2 border-pink-200" />


   <div class="llm-feature p-6 bg-purple-50 rounded-xl shadow-inner">
     <h2 class="text-2xl font-bold text-indigo-700 mb-4">‚ú® ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏°‡∏≤ 1 ‡∏õ‡∏µ ‚ú®</h2>
     <p class="text-gray-700 mb-4">‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏ô‡∏≤‡∏ô‡πÜ‡∏ô‡∏∞‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏¢!</p>
     <textarea
       id="patDetailsInput"
       class="w-full p-3 rounded-lg border border-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-300 mb-4 text-gray-800"
       rows="4"
       placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÅ‡∏û‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏ä‡∏≠‡∏ö‡πÅ‡∏°‡∏ß ‡∏ä‡∏≠‡∏ö‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏ä‡∏≠‡∏ö‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á K-Pop ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÜ"
     ></textarea>
     <button
       id="generateMessageBtn"
       class="w-full py-3 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors duration-200 flex items-center justify-center"
       onclick="generateBirthdayMessage()"
     >
       <span id="llmButtonText">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ß‡∏¢‡∏û‡∏£ ‚ú®</span>
       <span id="llmLoadingSpinner" class="loading-spinner hidden ml-2"></span>
     </button>
     <div id="llmMessageContainer" class="text-center mt-4 text-sm hidden"></div>
     <div id="generatedMessageOutput" class="mt-6 p-4 bg-purple-100 border border-purple-200 rounded-lg text-gray-800 text-left whitespace-pre-wrap">
       <!-- Generated message will appear here -->
     </div>
   </div>
 </div>


 <script>
   // LLM Feature JavaScript
   const patDetailsInput = document.getElementById('patDetailsInput');
   const generateMessageBtn = document.getElementById('generateMessageBtn');
   const llmButtonText = document.getElementById('llmButtonText');
   const llmLoadingSpinner = document.getElementById('llmLoadingSpinner');
   const llmMessageContainer = document.getElementById('llmMessageContainer');
   const generatedMessageOutput = document.getElementById('generatedMessageOutput');


   // Function to display messages for the LLM feature
   function showLlmMessage(msg, type) {
     llmMessageContainer.textContent = msg;
     llmMessageContainer.className = `text-center mt-4 text-sm ${type === 'success' ? 'text-green-600' : 'text-red-600'} block`;
     llmMessageContainer.classList.remove('hidden');
   }


   // Function to hide messages for the LLM feature
   function hideLlmMessage() {
     llmMessageContainer.classList.add('hidden');
   }


   // Main function to generate birthday message using Gemini API
   async function generateBirthdayMessage() {
     const details = patDetailsInput.value.trim();
     if (!details) {
       showLlmMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏û‡∏ó‡∏Å‡πà‡∏≠‡∏ô', 'error');
       return;
     }


     // Disable button, show loading spinner, clear previous messages
     generateMessageBtn.disabled = true;
     llmButtonText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';
     llmLoadingSpinner.classList.remove('hidden');
     hideLlmMessage();
     generatedMessageOutput.textContent = ''; // Clear previous generated message


     // Construct the prompt for the LLM
     const prompt = `Generate a heartfelt and personal birthday message in Thai for someone named Pat who is turning 19. Include details like: "${details}". Make it warm, encouraging, and suitable for a birthday card. The message should be concise, around 3-5 sentences.`;


     let chatHistory = [];
     chatHistory.push({ role: "user", parts: [{ text: prompt }] });
     const payload = { contents: chatHistory };
     const apiKey = ""; // API key will be provided by Canvas at runtime
     const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;


     // Exponential backoff retry logic for API calls
     let retries = 0;
     const maxRetries = 3;
     let delay = 1000; // Initial delay of 1 second


     while (retries < maxRetries) {
       try {
         const response = await fetch(apiUrl, {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify(payload)
         });


         // Handle HTTP errors and rate limiting
         if (!response.ok) {
           if (response.status === 429 && retries < maxRetries - 1) { // Too Many Requests (rate limit)
             console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
             await new Promise(res => setTimeout(res, delay)); // Wait before retrying
             delay *= 2; // Double the delay for exponential backoff
             retries++;
             continue; // Continue to the next iteration of the while loop
           }
           throw new Error(`HTTP error! status: ${response.status}`);
         }


         const result = await response.json();
         // Check if the response structure is as expected
         if (result.candidates && result.candidates.length > 0 &&
             result.candidates[0].content && result.candidates[0].content.parts &&
             result.candidates[0].content.parts.length > 0) {
           const text = result.candidates[0].content.parts[0].text;
           generatedMessageOutput.textContent = text; // Display the generated message
           showLlmMessage('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
         } else {
           showLlmMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
           console.error('Unexpected API response structure:', result);
         }
         break; // Exit the loop on successful API call and response processing
       } catch (error) {
         // Handle other errors during fetch or JSON parsing
         if (retries < maxRetries - 1) {
           console.error(`Attempt ${retries + 1} failed: ${error.message}. Retrying...`);
           await new Promise(res => setTimeout(res, delay));
           delay *= 2;
           retries++;
         } else {
           showLlmMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error.message, 'error');
           console.error('API call failed after multiple retries:', error);
         }
       }
     }


     // Re-enable button and hide loading spinner
     generateMessageBtn.disabled = false;
     llmButtonText.textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ß‡∏¢‡∏û‡∏£ ‚ú®';
     llmLoadingSpinner.classList.add('hidden');
   }
 </script>
</body>
</html>
